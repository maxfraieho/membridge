---
tags:
  - domain:arch
  - status:canonical
  - format:spec
  - feature:orchestration
created: 2026-02-24
updated: 2026-02-24
tier: 1
title: "Перспектива: Комплексна агентна система розробки"
dg-publish: true
---

# Перспектива: Комплексна агентна система розробки

> Created: 2026-02-24
> Author: architect
> Status: canonical
> Мова: Ukrainian (canonical)

---

## 0. Призначення

Визначає стратегічну перспективу еволюції поточної Integration Layer у повноцінну комплексну систему розробки будь-яких програмних рішень на основі агентів, персистентної пам'яті сесій та мультимодального доступу до LLM.

Поточний стан — набір інтегрованих компонентів. Цільовий стан — **Agentic Development Platform**: середовище, де людина-розробник і набір спеціалізованих агентів працюють у спільному контексті, з повною пам'яттю, через уніфікований інтерфейс, на розподіленій інфраструктурі.

---

## 1. Поточний стан системи

```
Claude CLI (сесія)
  ├── Membridge hooks       → синхронізує claude-mem.db між вузлами
  ├── Memory Backend        → git-монорепо Layer 1/2
  ├── NotebookLM Backend    → FastAPI proxy для document-grounded reasoning
  └── Lovable Frontend      → Projection + Proposal lifecycle
```

**Що вже працює:**
- Персистентна пам'ять сесій (claude-mem.db → MinIO через Membridge)
- Синхронізація між вузлами (Alpine/RPi/Orange) з leadership моделлю
- Ізольований проксі до NotebookLM як інструмент агентів
- Proposal lifecycle для consent-based мутацій
- Distributed leadership із lease protocol

**Що потребує доопрацювання:**
- Агенти ще не доступні як MCP-сервери всередині Claude CLI
- Немає уніфікованого LLM routing шару
- Development loop не замкнений: Implementation → Verification → Runtime не автоматизовані
- Немає cross-session entity continuity (кожна сесія стартує майже з нуля)

---

## 2. Цільова архітектура

```
┌─────────────────────────────────────────────────────────────────┐
│                  Agentic Development Platform                   │
│                                                                 │
│  Developer                                                      │
│     │                                                           │
│     ▼                                                           │
│  Claude CLI ◄──── MCP Bus (інструменти) ────────────────────┐  │
│     │                │                                       │  │
│     │         ┌──────┼──────────────────────────┐           │  │
│     │         │      │   MCP Servers (агенти)   │           │  │
│     │         │  [memory-agent]  [notebooklm]   │           │  │
│     │         │  [code-reviewer] [spec-agent]   │           │  │
│     │         │  [test-runner]   [arch-guardian] │           │  │
│     │         └──────────────────────────────────┘           │  │
│     │                                                         │  │
│     ▼                                                         │  │
│  Canonical Conveyor                                           │  │
│  Vision→Modeling→Spec→Impl→Verify→Runtime→Memory→Evolution   │  │
│     │                                                         │  │
│     ▼                                                         │  │
│  ┌─────────────────────────────────────────────────────────┐  │  │
│  │              Unified Memory Layer                       │  │  │
│  │  claude-mem.db (session) ← Membridge → MinIO           │  │  │
│  │  garden-bloom-memory (agent) ← git → Layer 1/2         │  │  │
│  │  Entity Graph (cross-session entities)                 │  │  │
│  └─────────────────────────────────────────────────────────┘  │  │
│                                                               │  │
│  ┌─────────────────────────────────────────────────────────┐  │  │
│  │              LLM Access Layer                           │  │  │
│  │  Direct API  │  NotebookLM Proxy  │  Custom Agents     │◄─┘  │
│  │  (Claude)    │  (grounded docs)   │  (specialized)     │     │
│  └─────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. LLM Access Patterns

Система підтримує три паттерни доступу до LLM, кожен для своєї задачі:

### 3.1 Direct API (Прямий API)

```
Claude CLI → Anthropic API (claude-sonnet / claude-opus)
  └── повний контекст сесії
  └── використання для: reasoning, code generation, planning
```

**Вже доступно.** Поточна основа роботи Claude CLI.

### 3.2 Document-Grounded Proxy (Заземлений проксі)

```
Claude CLI → MCP tool: notebooklm-query(question)
  └── FastAPI NotebookLM Backend (Replit)
      └── NotebookLM (Google) — відповідає виключно з документів
  └── використання для: research, spec grounding, anti-hallucination verification
```

**Частково реалізовано.** Потребує реєстрації як MCP server у `~/.claude/settings.json`.

### 3.3 Спеціалізовані агенти як проксі

```
Claude CLI → MCP tool: agent-proxy(agent_slug, task)
  └── Mastra Agent (Orchestration Layer)
      └── LLM вибирається агентом (Claude / GPT / Gemini / NLM)
  └── використання для: code review, security audit, spec generation,
                        test generation, architecture validation
```

**Потребує реалізації.** Ключова точка розширення системи.

---

## 4. Agent-as-MCP-Proxy: Архітектура

Агенти Garden Seedling можуть бути зареєстровані як MCP servers для Claude CLI. Це перетворює Claude CLI на оркестратор, що делегує спеціалізовані задачі спеціалізованим агентам.

### 4.1 Реєстрація MCP server

```json
// ~/.claude/settings.json (або claude_desktop_config.json)
{
  "mcpServers": {
    "memory-agent": {
      "command": "uvx",
      "args": ["mcp-memory-agent"],
      "env": { "MEMBRIDGE_DIR": "/home/vokov/membridge" }
    },
    "notebooklm": {
      "command": "python",
      "args": ["/home/vokov/membridge/mcp/notebooklm_server.py"],
      "env": { "NLM_API_KEY": "..." }
    },
    "arch-guardian": {
      "command": "python",
      "args": ["/home/vokov/membridge/mcp/agent_proxy_server.py"],
      "env": { "AGENT_SLUG": "architect-guardian" }
    }
  }
}
```

### 4.2 MCP Tool Schema для агента-проксі

```
Tool: agent-run
  Input:  { "agent_slug": str, "task": str, "context_hint": str }
  Output: { "artifact_id": str, "result": str, "proposals": [] }

Tool: memory-read
  Input:  { "query": str, "layer": 1 | 2 }
  Output: { "results": [{ "score": float, "excerpt": str }] }

Tool: notebooklm-query
  Input:  { "question": str, "sources": [] }
  Output: { "answer": str, "citations": [] }

Tool: propose-change
  Input:  { "target": str, "action": str, "payload": {} }
  Output: { "proposal_id": str, "status": "pending" }
```

### 4.3 Приклад: Claude CLI як оркестратор

```
Developer: "Проведи code review модуля sqlite_minio_sync.py і запропонуй покращення"

Claude CLI:
  1. tool: memory-read("sqlite_minio_sync architecture decisions")
     → завантажує контекст із Layer 1
  2. tool: notebooklm-query("best practices for distributed sync")
     → отримує заземлену відповідь із документів
  3. Аналізує код + контекст + grounded knowledge
  4. tool: agent-run("code-reviewer", "review sqlite_minio_sync.py")
     → спеціалізований агент виконує глибокий review
  5. tool: propose-change("sqlite_minio_sync.py", "propose-edit", {...})
     → Пропозиція з конкретними змінами

Результат: структурований code review із посиланнями на джерела,
           entity graph зв'язками та конкретними Пропозиціями
```

---

## 5. Unified Memory Layer (Уніфікований шар пам'яті)

Ключова проблема поточного стану: три ізольованих сховища пам'яті без cross-session continuity.

```
Поточно:
  claude-mem.db ──── Membridge ──── MinIO
  garden-bloom-memory ───────────── GitHub git
  Entity Graph ──────────────────── (немає persistence)

Цільовий стан:
  ┌─────────────────────────────────────────────────────────┐
  │              Unified Memory Router                      │
  │                                                         │
  │  Query: "що я знаю про sqlite_minio_sync leadership?"   │
  │                                                         │
  │  → BM25(claude-mem.db)        → session observations   │
  │  → BM25(garden-bloom-memory)  → agent reasoning        │
  │  → Entity Graph lookup        → entity relationships   │
  │  → Merge + rank → unified context                       │
  └─────────────────────────────────────────────────────────┘
              │
              ▼ єдиний контекстний пакет для Claude / агентів
```

**Інваріант:** Unified Memory Router — read-only. Записує виключно через Proposal lifecycle.

---

## 6. Повний Development Loop

```
┌──────────────────────────────────────────────────────────────────┐
│                    Development Loop v2                           │
│                                                                  │
│  1. VISION         Developer → Inbox → Brief Generator (NLM)    │
│     └─ output: BRIEF artifact                                    │
│                                                                  │
│  2. MODELING       arch-guardian agent → Entity Graph update     │
│     └─ output: PREPROCESSED_PROPOSAL artifact                   │
│                                                                  │
│  3. SPEC           spec-agent (MCP) → markdown spec             │
│     └─ output: SPEC artifact; Proposal pending                  │
│                                                                  │
│  4. IMPLEMENTATION Claude CLI + code-agent (MCP)                │
│     └─ reads: SPEC artifact + memory context                    │
│     └─ output: code changes; propose-edit Proposals             │
│                                                                  │
│  5. VERIFICATION   test-runner (MCP) + security-audit (MCP)     │
│     └─ output: VERIFICATION artifact; issues as Proposals       │
│                                                                  │
│  6. RUNTIME        Membridge deploy + OpenRC restart             │
│     └─ health check; metrics; alerts                            │
│                                                                  │
│  7. MEMORY         memory-agent (MCP) → Layer 1/2 update        │
│     └─ git commit до garden-bloom-memory                        │
│                                                                  │
│  8. EVOLUTION      arch-guardian reviews delta                  │
│     └─ proposes logic-update; optimizer agent                   │
│     └─ цикл повторюється                                        │
└──────────────────────────────────────────────────────────────────┘
```

Кожна фаза виробляє Артефакт. Кожна мутація — Пропозиція. Людина схвалює або відхиляє.

---

## 7. Roadmap: Можливі рішення

### Фаза 1 — MCP Integration (найближча)

| Задача | Рішення | Складність |
|--------|---------|-----------|
| Зареєструвати NotebookLM як MCP server | Python MCP server обгортка навколо FastAPI | Low |
| Зареєструвати memory-read як MCP tool | MCP server читає claude-mem.db + git Layer 1 | Low |
| Unified Memory Router (read-only) | BM25 merge через два сховища | Medium |

### Фаза 2 — Agent Proxies

| Задача | Рішення | Складність |
|--------|---------|-----------|
| agent-proxy MCP server | Generic MCP → Mastra bridge | Medium |
| code-reviewer agent | Mastra + Claude + code analysis tools | Medium |
| spec-agent | Маstra + NotebookLM + DRAKON output | Medium |
| Cross-session entity continuity | Entity Graph з persistence у MinIO | High |

### Фаза 3 — Autonomous Development Loop

| Задача | Рішення | Складність |
|--------|---------|-----------|
| Automated verification pipeline | test-runner agent + CI hooks | High |
| Logic Versioning для агентів | Optimizer agent (вже в Garden Seedling spec) | Medium |
| Multi-LLM routing | LLM Router: Claude / GPT / Gemini за задачею | High |
| Self-improving agents | Optimizer agent → logic-update Proposals | High |

---

## 8. Ключові інваріанти перспективи

**I-P1:** Людина залишається у контурі (Human-in-the-Loop) на всіх фазах, де результат є мутацією canonical storage.

**I-P2:** Кожен LLM-виклик у розробницькому контексті має бути заземленим або явно позначеним як ungrounded (для запобігання галюцинацій у коді).

**I-P3:** MCP servers — це адаптери, не нові сховища. Вся персистентність — через Unified Memory Layer.

**I-P4:** Агентна розробка не замінює розробника; вона підсилює його здатність утримувати складну систему в голові через Unified Memory та автоматизацію рутини.

**I-P5:** Будь-яке програмне рішення може бути розроблено у цьому середовищі, якщо воно описується через Spec artifact та верифікується через Verification artifact.

---

## Semantic Relations

**Цей документ є частиною:**
- [[_INDEX]] — Integration Layer, індекс пакету

**Залежить від:**
- [[АРХІТЕКТУРНИЙ_КОРІНЬ]] — аксіоми A1–A7 визначають границі еволюції
- [[КОНТРАКТ_АГЕНТА_V1]] — MCP servers є реалізацією Agent Contract
- [[АБСТРАКЦІЯ_РІВНЯ_ОРКЕСТРАЦІЇ]] — Orchestration Layer залишається vendor-agnostic
- [[ПАМ_ЯТЬ_АГЕНТА_GIT_DIFFMEM_V1]] — Unified Memory базується на DiffMem

**На цей документ посилаються:**
- [[ІНТЕГРАЦІЯ_NOTEBOOKLM_BACKEND]] — еволюція до MCP server
- [[ІНТЕГРАЦІЯ_MEMORY_BACKEND]] — еволюція до Unified Memory Router
- [[ІНТЕГРАЦІЯ_MEMBRIDGE]] — залишається інфраструктурою синхронізації
